(this["webpackJsonpdevice-demonstrator"]=this["webpackJsonpdevice-demonstrator"]||[]).push([[0],{14:function(e,t,n){e.exports=n(21)},19:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(10),i=n.n(c),o=(n(19),n(1)),s=n(2),u=n.n(s),l=n(4),d=function(e){return e.hide?null:a.a.createElement(a.a.Fragment,null,e.children)},m=function(e){var t=e.error;return a.a.createElement("dl",null,a.a.createElement("dt",null,"error.name"),a.a.createElement("dd",null,t.name),a.a.createElement("dt",null,"error.constructor.name"),a.a.createElement("dd",null,t.constructor.name),a.a.createElement("dt",null,"error.message"),a.a.createElement("dd",null,t.message),a.a.createElement("dt",null,"JSON.stringify(error, null, 2)"),a.a.createElement("dd",null,JSON.stringify(t,null,2)))},v=function(e){var t=e.content,n=JSON.stringify(t,null,2);return a.a.createElement("pre",null,n)},f=function(e){return function(){var t=Object(l.a)(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,n;case 3:return t.t1=t.sent,t.abrupt("return",(0,t.t0)(t.t1));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},p=function(e){return function(){var t=Object(l.a)(u.a.mark((function t(n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n;case 3:return t.abrupt("return",{success:!1,messages:["expected a rejected promise"]});case 6:return t.prev=6,t.t0=t.catch(0),t.abrupt("return",e(t.t0));case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e){return t.apply(this,arguments)}}()},h={summary:"undefined constraints",description:"pass undefined as constraints",constraints:void 0,expected:{prompt:void 0,denied:void 0,granted:{description:"reject and communicate that at least one constrain has to be present",checks:[{what:"TypeError",predicate:p((function(e){return{success:e instanceof TypeError,messages:["got: ".concat(e.toString())]}}))},{what:"error message",predicate:p((function(e){var t="Failed to execute 'getUserMedia' on 'MediaDevices': At least one of audio and video must be requested";return{success:e.message===t,messages:["expected: ".concat(t),"got: '".concat(e.message,"'")]}}))}]}}},b={summary:"requested device type not attached",description:"Requesting a camera but none is attached",constraints:{video:!0},expected:{prompt:void 0,denied:void 0,granted:{description:"reject and communicate that the requested device was not found",checks:[{what:"DOMException",predicate:p((function(e){return{success:e instanceof DOMException,messages:["got: ".concat(e.toString())]}}))},{what:"error message",predicate:p((function(e){var t="Requested device not found";return{success:e.message===t,messages:["expected: ".concat(t),"got: '".concat(e.message,"'")]}}))}]}}},g={summary:"all constraints false",description:"pass false to the video and audio constraint",constraints:{audio:!1,video:!1},expected:{prompt:void 0,denied:void 0,granted:{description:"reject and communicate that at least one constrain has to be set to true",checks:[{what:"TypeError",predicate:p((function(e){return{success:e instanceof TypeError,messages:["got: ".concat(e.toString())]}}))},{what:"error message",predicate:p((function(e){var t="Failed to execute 'getUserMedia' on 'MediaDevices': At least one of audio and video must be requested";return{success:e.message===t,messages:["expected: ".concat(t),"got: '".concat(e.message,"'")]}}))}]}}},E={summary:"bogus device id",description:"the constraint contains a deviceId that no device has",constraints:{audio:{deviceId:"bogus"}},expected:{prompt:void 0,denied:void 0,granted:{description:"fallback to any other audio device",checks:[{what:"stream is active",predicate:f((function(e){return{success:e.active}}))},{what:"stream has an id",predicate:f((function(e){return{success:e.id.length>0}}))}]}}},y={summary:"existing device",description:"any camera device without any other constraints",constraints:{video:!0},expected:{prompt:void 0,denied:{description:"should be rejected",checks:[{what:"DOMException",predicate:p((function(e){return{success:e instanceof DOMException,messages:["got: ".concat(e.constructor.name)]}}))},{what:"NotAllowedError",predicate:p((function(e){var t=e.name;return{success:"NotAllowedError"===t,messages:["got: ".concat(t)]}}))}]},granted:{description:"tbd",checks:[]}}},k=function(){var e=new Map;return e.set(y.summary,y),e.set(E.summary,E),e.set(h.summary,h),e.set(g.summary,g),e.set(b.summary,b),e}(),O=function(e){var t=e.track,n=t.getCapabilities?t.getCapabilities():"track.getCapabilities does not exist";return a.a.createElement("dl",null,a.a.createElement("dt",null,"id"),a.a.createElement("dd",null,e.id),a.a.createElement("dt",null,"readyState"),a.a.createElement("dd",null,e.readyState),a.a.createElement("dt",null,"enabled"),a.a.createElement("dd",null,String(e.enabled)),a.a.createElement("dt",null,"kind"),a.a.createElement("dd",null,e.kind),a.a.createElement("dt",null,"label"),a.a.createElement("dd",null,e.label),a.a.createElement("dt",null,"muted"),a.a.createElement("dd",null,String(e.muted)),a.a.createElement("dt",null,"capabilities"),a.a.createElement("dd",null,a.a.createElement(v,{content:n})),a.a.createElement("dt",null,"constraints"),a.a.createElement("dd",null,a.a.createElement(v,{content:t.getConstraints()})),a.a.createElement("dt",null,"settings"),a.a.createElement("dd",null,a.a.createElement(v,{content:t.getSettings()})))},j=n(13),S=function(e){var t=e.srcObject,n=void 0===t?null:t,c=e.muted,i=void 0!==c&&c,o=Object(j.a)(e,["srcObject","muted"]),s=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e=s.current;null!==e&&(e.srcObject!==n&&(e.srcObject=n),e.muted!==i&&(e.muted=i))}),[n,i]),a.a.createElement("video",Object.assign({},o,{ref:s}))},C=function(e){var t=e.stream,n=Object(r.useState)(!0),c=Object(o.a)(n,2),i=(c[0],c[1]),s=function(){i((function(e){return!e}))},u=function(){return null===t?[]:t.getTracks()},l=u().map((function(e){return a.a.createElement("li",{key:e.id},a.a.createElement(O,{enabled:e.enabled,id:e.id,kind:e.kind,label:e.label,muted:e.muted,readyState:e.readyState,track:e}))}));return a.a.createElement("div",{style:{display:"flex"}},a.a.createElement("h1",null,"Scenario View"),a.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},a.a.createElement("button",{onClick:function(){u().forEach((function(e){return e.enabled=!1})),s()}},"pause"),a.a.createElement("button",{onClick:function(){u().forEach((function(e){return e.enabled=!0})),s()}},"continue"),a.a.createElement("button",{onClick:function(){u().forEach((function(e){return e.stop()})),s()}},"stop")),a.a.createElement(S,{id:"video-chat",srcObject:t,autoPlay:!0}),t&&a.a.createElement("div",null,a.a.createElement("h2",null,"stream"),a.a.createElement("ul",null,a.a.createElement("li",null,"id: ",t.id),a.a.createElement("li",null,"active: ",JSON.stringify(t.active))),a.a.createElement("h2",null,"tracks"),a.a.createElement("ul",null,l)))},D=function(e){return e instanceof Error?Promise.reject(e):Promise.resolve(e)},w={permissionState:"granted",scenarioSummary:b.summary},x=function(){var e=Object(r.useState)(),t=Object(o.a)(e,2),n=t[0],c=t[1],i=Object(r.useState)(""),s=Object(o.a)(i,2),f=s[0],p=s[1],h=Object(r.useState)(!1),b=Object(o.a)(h,2),g=b[0],E=b[1],y=Object(r.useState)(),O=Object(o.a)(y,2),j=O[0],S=O[1],x=Object(r.useState)(null),I=Object(o.a)(x,2),R=I[0],L=I[1],M=Object(r.useState)([]),P=Object(o.a)(M,2),F=P[0],U=P[1],N=Object(r.useState)(w.permissionState),T=Object(o.a)(N,2),_=T[0],A=T[1];Object(r.useEffect)((function(){try{var e="undefined"===f?void 0:JSON.parse(f);S(e),E(!1)}catch(t){E(!0)}}),[f,E]),Object(r.useEffect)((function(){var e;if(void 0!==n){var t=null===(e=k.get(n))||void 0===e?void 0:e.constraints,r=void 0===t?"undefined":JSON.stringify(t,null,2);p(r)}else{var a=Array.from(k.keys()),i=a.includes(w.scenarioSummary)?w.scenarioSummary:a[0];c(i)}}),[n]),Object(r.useEffect)((function(){U((function(){return[]}))}),[n]);var J=function(){var e=Object(l.a)(u.a.mark((function e(){var t,r,a,c,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(a=k.get(null!==n&&void 0!==n?n:""))&&null!==R){e.next=3;break}return e.abrupt("return");case 3:return c=null!==(t=null===(r=a.expected[_])||void 0===r?void 0:r.checks)&&void 0!==t?t:[],i=c.map(function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.predicate(D(R));case 3:n=e.sent,e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),r=["check threw exception ".concat(e.t0.toString())],n={success:!1,messages:r};case 10:return e.abrupt("return",{what:t.what,details:n});case 11:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()),e.t0=U,e.next=8,Promise.all(i);case 8:e.t1=e.sent,(0,e.t0)(e.t1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a.a.createElement("div",null,a.a.createElement("h1",{key:"test-rig"},"Test Rig",g?" (parse error)":""),a.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},a.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},a.a.createElement("select",{name:"device"},a.a.createElement("option",null,"camera"),a.a.createElement("option",null,"microphone")),a.a.createElement("select",{name:"permission",onChange:function(e){var t=e.target.value;"granted"!==t&&"denied"!==t&&"prompt"!==t||A(t)},value:_},a.a.createElement("option",{value:"granted"},"granted"),a.a.createElement("option",{value:"denied"},"denied"),a.a.createElement("option",{value:"prompt"},"prompt")),a.a.createElement("select",{name:"scenarios",value:n,onChange:function(e){return c(e.target.value)}},Array.from(k.keys()).map((function(e){return a.a.createElement("option",{value:e,key:e},e)})))),a.a.createElement("textarea",{value:f,onChange:function(e){return p(e.target.value)}}),a.a.createElement("button",{onClick:function(){navigator.mediaDevices.getUserMedia(j).then((function(e){return L((function(){return e}))})).catch((function(e){return L((function(){return e}))}))}},"start"),a.a.createElement("button",{disabled:null===R,onClick:J},"run checks"),a.a.createElement("button",{onClick:function(){U((function(){return[]}))}},"clear checks"),a.a.createElement("button",{onClick:function(){R instanceof MediaStream&&R.getTracks().forEach((function(e){return e.stop()})),L(null)}},"detach"),a.a.createElement("ul",{key:"results"},F.map((function(e,t){var n,r=e.details.success?"\u2705":"\u274c",c=null!==(n=e.details.messages)&&void 0!==n?n:[],i=!e.details.success&&0!==c.length?a.a.createElement("ul",{key:"message ".concat(t)},c.map((function(e,n){return a.a.createElement("li",{key:"message ".concat(t," ").concat(n)},e)}))):null;return a.a.createElement(a.a.Fragment,{key:"doombuggy ".concat(t)},a.a.createElement("li",{key:"check result ".concat(t)},"".concat(r,": ").concat(e.what)),i)})))),null===R?null:R instanceof MediaStream?a.a.createElement(C,{stream:R}):a.a.createElement(m,{error:R}),a.a.createElement(d,{hide:!0},a.a.createElement(v,{content:navigator.mediaDevices.getSupportedConstraints()})))},I=a.a.createContext(void 0),R=function(){var e=Object(r.useContext)(I);if(void 0===e)throw new Error("Context not available in component tree parents");return e.recordingDirector},L=function(e){var t=R(),n=Object(r.useState)({stream:null,streamError:"none"}),a=Object(o.a)(n,2),c=a[0],i=a[1];return Object(r.useEffect)((function(){if(void 0!==e){var n=t.videoStreamSubscriptionFor(e);return n.onDeviceRemoved((function(){n.cancel(),i({stream:null,streamError:"DeviceRemoved"})})),n.stream.then((function(e){return i((function(){return{stream:e,streamError:"none"}}))})).catch((function(){return i((function(){return{stream:null,streamError:"CouldNotOpen"}}))})),function(){n.cancel(),i((function(){return{stream:null,streamError:"none"}}))}}}),[t,e]),c},M=function(){var e=Object(r.useState)(void 0),t=Object(o.a)(e,2),n=t[0],c=t[1],i=R();Object(r.useEffect)((function(){var e=function(e){c((function(){return e}))};return i.addOnCameraSelectionChanged(e),function(){i.removeOnCameraSelectionChanged(e)}}),[i]);var s=L(n),u=s.stream,l=s.streamError;if(void 0===n)return a.a.createElement("div",null,"No device selected");if("none"!==l)return a.a.createElement("div",null,l);if(null===u)return a.a.createElement("div",null,"Opening stream");return a.a.createElement("div",null,a.a.createElement(S,{srcObject:u,autoPlay:!0,onClick:function(){i.clearCameraSelection()}}),a.a.createElement("div",null,u.id))},P=n(3),F=function(e){var t,n=e.recordingDirector,r=e.device,c=e.index,i=L(r),o=i.stream,s=i.streamError,u="none"===s;return a.a.createElement("div",null,a.a.createElement("h4",null,"Camera ",c),a.a.createElement("ul",null,a.a.createElement("li",null,"device label: ",r.label),a.a.createElement("li",null,"device id: ",r.deviceId),a.a.createElement("li",null,"group id: ",r.groupId),a.a.createElement("li",null,"stream id: ",null!==(t=null===o||void 0===o?void 0:o.id)&&void 0!==t?t:"no-stream")),!u&&a.a.createElement("div",null,s),u&&a.a.createElement(S,{onClick:function(){n.selectCamera(r)},width:150,srcObject:o,autoPlay:!0}))},U=function(){var e=R(),t=Object(r.useState)({showPreviews:!1,forceReRender:0}),n=Object(o.a)(t,2),c=n[0].showPreviews,i=n[1];Object(r.useEffect)((function(){var t=function(){i((function(e){return Object(P.a)(Object(P.a)({},e),{},{forceReRender:e.forceReRender+1})}))};return e.addOnUpdateDevicesListener(t),function(){e.removeOnUpdateDevicesListener(t)}}),[e]);var s=c?a.a.createElement("button",{onClick:function(){return i((function(e){return Object(P.a)(Object(P.a)({},e),{},{showPreviews:!1})}))}},"Hide Previews"):a.a.createElement("button",{onClick:function(){return i((function(e){return Object(P.a)(Object(P.a)({},e),{},{showPreviews:!0})}))}},"Show Previews"),u=c?e.cameras().map((function(t,n){return a.a.createElement(F,{key:t.deviceId,index:n,device:t,recordingDirector:e})})):null;return a.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},s,u)},N=n(12),T=n(7),_=n(8),A=n(11),J=function(){},B=function(){function e(t,n){Object(T.a)(this,e),this.recordingDirector=t,this.subscriptionDetails=n,this._onDeviceRemoved=function(){},this._canceled=!1,this._deviceRemoved=!1}return Object(_.a)(e,[{key:"onDeviceRemoved",value:function(e){this._onDeviceRemoved=e}},{key:"deviceRemoved",value:function(){this._deviceRemoved=!0,this._onDeviceRemoved()}},{key:"cancel",value:function(){this.recordingDirector.cancelSubscription(this.subscriptionDetails),this._canceled=!0}},{key:"stream",get:function(){return this._canceled||this._deviceRemoved?Promise.reject("subscription canceled"):this.subscriptionDetails.stream}}]),e}(),q=function(){function e(){Object(T.a)(this,e),this.subscriptionsByDevice=new Map}return Object(_.a)(e,[{key:"addSubscriber",value:function(e){var t=e.subscriptionDetails;(function(e,t,n){var r=e.get(t);if(void 0!==r)return r;var a=n(t);return e.set(t,a),a})(this.subscriptionsByDevice,t.deviceIdentifier,(function(){return{stream:e.stream,subscriptions:new Map}})).subscriptions.set(t.subscriptionIdentifier,e)}},{key:"subscriptionsTo",value:function(e){return Array.from(this.subscriptionsByDevice.entries()).filter((function(t){var n=Object(o.a)(t,2),r=n[0];n[1];return e.includes(r)})).map((function(e){var t=Object(o.a)(e,2),n=(t[0],t[1]);return Array.from(n.subscriptions.values())})).reduce((function(e,t){return e.concat(t)}),[])}},{key:"removeSubscriber",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J,n=this.subscriptionsByDevice.get(e.deviceIdentifier);void 0!==n&&(n.subscriptions.delete(e.subscriptionIdentifier),0===n.subscriptions.size&&(this.subscriptionsByDevice.delete(e.deviceIdentifier),t(n.stream)))}},{key:"streamFor",value:function(e){var t=this.subscriptionsByDevice.get(e.deviceId);if(void 0!==t)return t.stream}}]),e}(),z=function(){function e(){Object(T.a)(this,e),this.onUpdateDevicesListeners=new Set,this.subscriptionLedger=new q,this.devices=[],this.onCameraSelectionChangedListeners=new Set,this.selectedCamera=void 0}return Object(_.a)(e,[{key:"updateDevices",value:function(e){var t,n=e.map((function(e){return e.deviceId})),r=this.devices.filter((function(e){return!n.includes(e.deviceId)})).map((function(e){return e.deviceId}));this.devices.splice(0,this.devices.length),(t=this.devices).push.apply(t,Object(N.a)(e)),this.onUpdateDevicesListeners.forEach((function(e){return e()})),this.subscriptionLedger.subscriptionsTo(r).forEach((function(e){return e.deviceRemoved()}))}},{key:"cameras",value:function(){return this.devices.filter((function(e){return"videoinput"===e.kind})).filter((function(e){return"default"!==e.label}))}},{key:"videoStreamSubscriptionFor",value:function(e){var t={deviceIdentifier:e.deviceId,stream:this.streamForDevice(e),subscriptionIdentifier:Object(A.uuid)()},n=new B(this,t);return this.subscriptionLedger.addSubscriber(n),n}},{key:"cancelSubscription",value:function(e){var t=this;this.subscriptionLedger.removeSubscriber(e,(function(e){return e.then(t.close).catch(J)}))}},{key:"streamForDevice",value:function(e){var t=this,n=this.subscriptionLedger.streamFor(e);return void 0!==n?n:this.videoStreamFor(e).then((function(n){return""===e.label&&navigator.mediaDevices.enumerateDevices().then((function(e){var n=e.map((function(e){return{kind:e.kind,label:e.label,deviceId:e.deviceId,groupId:e.groupId}}));console.log(n),t.updateDevices(n)})),n}))}},{key:"videoStreamFor",value:function(e){return navigator.mediaDevices.getUserMedia({video:{deviceId:e.deviceId}})}},{key:"selectCamera",value:function(e){var t=this;void 0!==this.selectedCamera&&this.selectedCamera.kind===e.kind&&this.selectedCamera.groupId===e.groupId&&this.selectedCamera.deviceId===e.deviceId?console.log("already selected"):(this.selectedCamera=e,this.onCameraSelectionChangedListeners.forEach((function(e){return e(t.selectedCamera)})))}},{key:"clearCameraSelection",value:function(){var e=this;void 0!==this.selectedCamera&&(this.selectedCamera=void 0,this.onCameraSelectionChangedListeners.forEach((function(t){return t(e.selectedCamera)})))}},{key:"addOnUpdateDevicesListener",value:function(e){this.onUpdateDevicesListeners.add(e)}},{key:"removeOnUpdateDevicesListener",value:function(e){this.onUpdateDevicesListeners.delete(e)}},{key:"addOnCameraSelectionChanged",value:function(e){this.onCameraSelectionChangedListeners.add(e),e(this.selectedCamera)}},{key:"removeOnCameraSelectionChanged",value:function(e){this.onCameraSelectionChangedListeners.delete(e)}},{key:"close",value:function(e){e&&e.getTracks().forEach((function(e){return e.stop()}))}}]),e}(),H=function(){navigator.mediaDevices.enumerateDevices().then((function(e){console.log("there are ".concat(e.length," devices"));var t=e.map((function(e){return"".concat(e.kind," ").concat(e.label," (").concat(e.groupId,":").concat(e.deviceId,")")})).join("\n");console.log(t)})).catch((function(e){return console.log(e)}))},V=function(){var e=Object(r.useState)(!0),t=Object(o.a)(e,2),n=t[0],c=t[1];return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{style:{display:"flex"}},a.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},a.a.createElement("button",{onClick:H},"log device information"),a.a.createElement("button",{onClick:function(){return c((function(e){return!e}))}},"toggle camera picker"),n&&a.a.createElement(U,null)),a.a.createElement(M,null)))},G=function(){var e=new z,t=function(){return function(e){navigator.mediaDevices.enumerateDevices().then((function(t){e.updateDevices(t.map((function(e){return{groupId:e.groupId,deviceId:e.deviceId,label:e.label,kind:e.kind}})))})).catch((function(e){console.log(e.name+": "+e.message)}))}(e)};return t(),navigator.mediaDevices.addEventListener("devicechange",t),function(){return a.a.createElement(I.Provider,{value:{recordingDirector:e}},a.a.createElement(V,null),a.a.createElement(x,null))}}();i.a.render(a.a.createElement("div",null,a.a.createElement(G,null)),document.getElementById("root"))}},[[14,1,2]]]);
//# sourceMappingURL=main.59abac2a.chunk.js.map