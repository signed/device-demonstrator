(this["webpackJsonpdevice-demonstrator"]=this["webpackJsonpdevice-demonstrator"]||[]).push([[0],{10:function(e,t,n){e.exports=n(16)},15:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(6),c=n.n(a),o=(n(15),n(1)),s=n(2),l=n(4),u=n(3),d=n(9),v=function(e){var t=e.srcObject,n=void 0===t?null:t,a=e.muted,c=void 0!==a&&a,o=Object(d.a)(e,["srcObject","muted"]),s=Object(i.useRef)(null);return Object(i.useEffect)((function(){var e=s.current;null!==e&&(e.srcObject!==n&&(e.srcObject=n),e.muted!==c&&(e.muted=c))}),[n,c]),r.a.createElement("video",Object.assign({},o,{ref:s}))},m=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).handleVideoClicked=function(){i.props.recordingDirector.clearCameraSelection()},i.handleDeviceSelectionChange=function(e){i.closeExistingStream(),i.setState({device:e},(function(){if(void 0!==e){var t=i.props.recordingDirector.videoStreamSubscriptionFor(e);i.setState({mediaStreamSubscription:t}),t.stream.then((function(e){return i.setState({stream:e})})).catch((function(){return i.setState({streamError:!0})}))}}))},i.state={streamError:!1,stream:null,mediaStreamSubscription:void 0,device:void 0},i}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.props.recordingDirector.addOnCameraSelectionChanged(this.handleDeviceSelectionChange)}},{key:"componentWillUnmount",value:function(){this.props.recordingDirector.removeOnCameraSelectionChanged(this.handleDeviceSelectionChange),this.closeExistingStream(),this.setState({device:void 0,streamError:!1})}},{key:"render",value:function(){return void 0===this.state.device?r.a.createElement("div",null,"No device selected"):null===this.state.stream?r.a.createElement("div",null,"Opening stream"):r.a.createElement("div",null,r.a.createElement(v,{srcObject:this.state.stream,autoPlay:!0,onClick:this.handleVideoClicked}),r.a.createElement("div",null,this.state.stream.id))}},{key:"closeExistingStream",value:function(){var e=this.state.mediaStreamSubscription;void 0!==e&&(e.cancel(),this.setState({stream:null,mediaStreamSubscription:void 0}))}}]),n}(r.a.Component),h=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).handleSelect=function(){i.props.recordingDirector.selectCamera(i.props.device)},i.state={mediaStreamSubscription:void 0,streamError:!1,stream:null},i}return Object(s.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.recordingDirector.videoStreamSubscriptionFor(this.props.device);this.setState({mediaStreamSubscription:t}),t.stream.then((function(t){return e.setState({stream:t})})).catch((function(){return e.setState({streamError:!0})}))}},{key:"componentWillUnmount",value:function(){var e=this.state.mediaStreamSubscription;void 0!==e&&(e.cancel(),this.setState({stream:null,mediaStreamSubscription:void 0}))}},{key:"render",value:function(){var e,t=this.state.stream,n=this.props.device;return r.a.createElement("div",null,r.a.createElement("h4",null,"Camera ",this.props.index),r.a.createElement("ul",null,r.a.createElement("li",null,"device label: ",n.label),r.a.createElement("li",null,"device id: ",n.deviceId),r.a.createElement("li",null,"group id: ",n.groupId),r.a.createElement("li",null,"stream id: ",null!==(e=null===t||void 0===t?void 0:t.id)&&void 0!==e?e:"no-stream")),r.a.createElement(v,{onClick:this.handleSelect,width:150,srcObject:t,autoPlay:!0}))}}]),n}(r.a.Component),p=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).availableDevicesChanged=function(){i.setState((function(e){return{forceReRender:e.forceReRender+1}}))},i.handleShowPreview=function(){i.setState({showPreviews:!0})},i.handleHidePreview=function(){i.setState({showPreviews:!1})},i.state={showPreviews:!1,forceReRender:0},i}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.props.recordingDirector.addOnUpdateDevicesListener(this.availableDevicesChanged)}},{key:"componentWillUnmount",value:function(){this.props.recordingDirector.removeOnUpdateDevicesListener(this.availableDevicesChanged)}},{key:"render",value:function(){var e=this,t=this.state.showPreviews?r.a.createElement("button",{onClick:this.handleHidePreview},"Hide Previews"):r.a.createElement("button",{onClick:this.handleShowPreview},"Show Previews"),n=this.state.showPreviews?this.props.recordingDirector.cameras().map((function(t,n){return r.a.createElement(h,{key:t.deviceId,index:n,device:t,recordingDirector:e.props.recordingDirector})})):null;return r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},t,n)}}]),n}(r.a.Component),f=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return this.props.hide?null:r.a.createElement(r.a.Fragment,null,this.props.children)}}]),n}(r.a.Component),b=function(e){var t=e.content,n=JSON.stringify(t,null,2);return r.a.createElement("pre",null,n)},g=n(8),E=n(7),S=function(){},k=function(){function e(t,n){Object(o.a)(this,e),this.recordingDirector=t,this.subscriptionDetails=n,this.canceled=!1}return Object(s.a)(e,[{key:"cancel",value:function(){this.recordingDirector.cancelSubscription(this.subscriptionDetails),this.canceled=!0}},{key:"stream",get:function(){return this.canceled?Promise.reject("subscription canceled"):this.subscriptionDetails.stream}}]),e}(),y=function(){function e(){Object(o.a)(this,e),this.subscriptionsByDevice=new Map}return Object(s.a)(e,[{key:"addSubscriber",value:function(e){var t=e.device.deviceId,n=this.subscriptionsByDevice.get(t);void 0===n&&(n={stream:e.stream,subscribers:new Set},this.subscriptionsByDevice.set(t,n)),n.subscribers.add(e.subscriberIdentifier)}},{key:"removeSubscriber",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S,n=this.subscriptionsByDevice.get(e.device.deviceId);void 0!==n&&(n.subscribers.delete(e.subscriberIdentifier),0===n.subscribers.size&&(this.subscriptionsByDevice.delete(e.device.deviceId),t(n.stream)))}},{key:"streamFor",value:function(e){var t=this.subscriptionsByDevice.get(e.deviceId);if(void 0!==t)return t.stream}}]),e}(),D=function(){function e(){Object(o.a)(this,e),this.onUpdateDevicesListeners=new Set,this.subscriptionLedger=new y,this.devices=[],this.onCameraSelectionChangedListeners=new Set,this.selectedCamera=void 0}return Object(s.a)(e,[{key:"updateDevices",value:function(e){var t;this.devices.splice(0,this.devices.length),(t=this.devices).push.apply(t,Object(g.a)(e)),this.onUpdateDevicesListeners.forEach((function(e){return e()}))}},{key:"cameras",value:function(){return this.devices.filter((function(e){return"videoinput"===e.kind})).filter((function(e){return"default"!==e.label}))}},{key:"videoStreamSubscriptionFor",value:function(e){var t={device:e,stream:this.streamForDevice(e),subscriberIdentifier:Object(E.uuid)()};return this.subscriptionLedger.addSubscriber(t),new k(this,t)}},{key:"cancelSubscription",value:function(e){var t=this;this.subscriptionLedger.removeSubscriber(e,(function(e){return e.then(t.close).catch(S)}))}},{key:"streamForDevice",value:function(e){var t=this,n=this.subscriptionLedger.streamFor(e);return void 0!==n?n:this.videoStreamFor(e).then((function(n){return""===e.label&&navigator.mediaDevices.enumerateDevices().then((function(e){var n=e.map((function(e){return{kind:e.kind,label:e.label,deviceId:e.deviceId,groupId:e.groupId}}));console.log(n),t.updateDevices(n)})),n}))}},{key:"videoStreamFor",value:function(e){return navigator.mediaDevices.getUserMedia({video:{deviceId:e.deviceId}})}},{key:"selectCamera",value:function(e){var t=this;void 0!==this.selectedCamera&&this.selectedCamera.kind===e.kind&&this.selectedCamera.groupId===e.groupId&&this.selectedCamera.deviceId===e.deviceId?console.log("already selected"):(this.selectedCamera=e,this.onCameraSelectionChangedListeners.forEach((function(e){return e(t.selectedCamera)})))}},{key:"clearCameraSelection",value:function(){var e=this;void 0!==this.selectedCamera&&(this.selectedCamera=void 0,this.onCameraSelectionChangedListeners.forEach((function(t){return t(e.selectedCamera)})))}},{key:"addOnUpdateDevicesListener",value:function(e){this.onUpdateDevicesListeners.add(e)}},{key:"removeOnUpdateDevicesListener",value:function(e){this.onUpdateDevicesListeners.delete(e)}},{key:"addOnCameraSelectionChanged",value:function(e){this.onCameraSelectionChangedListeners.add(e),e(this.selectedCamera)}},{key:"removeOnCameraSelectionChanged",value:function(e){this.onCameraSelectionChangedListeners.delete(e)}},{key:"close",value:function(e){e&&e.getTracks().forEach((function(e){return e.stop()}))}}]),e}(),C=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e=this.props.track;return(r.a.createElement("dl",null,r.a.createElement("dt",null,"id"),r.a.createElement("dd",null,this.props.id),r.a.createElement("dt",null,"readyState"),r.a.createElement("dd",null,this.props.readyState),r.a.createElement("dt",null,"enabled"),r.a.createElement("dd",null,String(this.props.enabled)),r.a.createElement("dt",null,"kind"),r.a.createElement("dd",null,this.props.kind),r.a.createElement("dt",null,"label"),r.a.createElement("dd",null,this.props.label),r.a.createElement("dt",null,"muted"),r.a.createElement("dd",null,String(this.props.muted)),r.a.createElement("dt",null,"capabilities"),r.a.createElement("dd",null,r.a.createElement(b,{content:e.getCapabilities()})),r.a.createElement("dt",null,"constraints"),r.a.createElement("dd",null,r.a.createElement(b,{content:e.getConstraints()})),r.a.createElement("dt",null,"settings"),r.a.createElement("dd",null,r.a.createElement(b,{content:e.getSettings()}))))}}]),n}(r.a.Component),O=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).handleStart=function(){navigator.mediaDevices.getUserMedia({video:!0}).then((function(e){i.setState({source:e})})).catch((function(e){alert(e)}))},i.handlePause=function(){i.tracks().forEach((function(e){return e.enabled=!1})),i.triggerRender()},i.handleContinue=function(){i.tracks().forEach((function(e){return e.enabled=!0})),i.triggerRender()},i.handleStop=function(){i.tracks().forEach((function(e){return e.stop()})),i.triggerRender()},i.handleDetach=function(){i.setState({source:null})},i.state={source:null},i}return Object(s.a)(n,[{key:"tracks",value:function(){var e=this.state.source;return null===e?[]:e.getTracks()}},{key:"render",value:function(){var e=this.tracks().map((function(e){return r.a.createElement("li",{key:e.id},r.a.createElement(C,{enabled:e.enabled,id:e.id,kind:e.kind,label:e.label,muted:e.muted,readyState:e.readyState,track:e}))}));return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("h1",null,this.props.title),r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},r.a.createElement("button",{onClick:this.handleStart},"start"),r.a.createElement("button",{onClick:this.handlePause},"pause"),r.a.createElement("button",{onClick:this.handleContinue},"continue"),r.a.createElement("button",{onClick:this.handleStop},"stop"),r.a.createElement("button",{onClick:this.handleDetach},"detach")),r.a.createElement(v,{id:"video-chat",srcObject:this.state.source,autoPlay:!0}),r.a.createElement("div",null,r.a.createElement("h2",null,"tracks"),r.a.createElement("ul",null,e)))}},{key:"triggerRender",value:function(){this.setState(this.state)}}]),n}(r.a.Component),j=function(){navigator.mediaDevices.enumerateDevices().then((function(e){console.log("there are ".concat(e.length," devices"));var t=e.map((function(e){return"".concat(e.kind," ").concat(e.label," (").concat(e.groupId,":").concat(e.deviceId,")")})).join("\n");console.log(t)})).catch((function(e){return console.log(e)}))},w=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},r.a.createElement("button",{onClick:j},"log device information"),r.a.createElement(p,{recordingDirector:e.recordingDirector})),r.a.createElement(m,{recordingDirector:e.recordingDirector})),r.a.createElement(f,{hide:!0},r.a.createElement(O,{title:"one"}),r.a.createElement(b,{content:navigator.mediaDevices.getSupportedConstraints()})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var I=function(){var e=new D,t=function(){return function(e){navigator.mediaDevices.enumerateDevices().then((function(t){e.updateDevices(t.map((function(e){return{groupId:e.groupId,deviceId:e.deviceId,label:e.label,kind:e.kind}})))})).catch((function(e){console.log(e.name+": "+e.message)}))}(e)};return t(),navigator.mediaDevices.addEventListener("devicechange",t),function(){return r.a.createElement(w,{recordingDirector:e})}}();c.a.render(r.a.createElement("div",null,r.a.createElement(I,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[10,1,2]]]);
//# sourceMappingURL=main.91fafe81.chunk.js.map