(this["webpackJsonpdevice-demonstrator"]=this["webpackJsonpdevice-demonstrator"]||[]).push([[0],{19:function(e,t,n){},22:function(e,t,n){"use strict";n.r(t);var c=n(1),i=n.n(c),r=n(13),s=n.n(r),a=(n(19),n(5)),o=n(6),d=n.n(o),u=n(7),l=n(0),j=function(e){return e.hide?null:Object(l.jsx)(i.a.Fragment,{children:e.children})},b=function(e){var t=e.error;return Object(l.jsxs)("dl",{children:[Object(l.jsx)("dt",{children:"error.name"}),Object(l.jsx)("dd",{children:t.name}),Object(l.jsx)("dt",{children:"error.constructor.name"}),Object(l.jsx)("dd",{children:t.constructor.name}),Object(l.jsx)("dt",{children:"error.message"}),Object(l.jsx)("dd",{children:t.message}),Object(l.jsx)("dt",{children:"JSON.stringify(error, null, 2)"}),Object(l.jsx)("dd",{children:JSON.stringify(t,null,2)})]})},v=function(e){var t=e.content,n=JSON.stringify(t,null,2);return Object(l.jsx)("pre",{children:n})},h=n(8),f=function(e){var t=e.track,n=t.getCapabilities?t.getCapabilities():"track.getCapabilities does not exist";return Object(l.jsxs)("dl",{children:[Object(l.jsx)("dt",{children:"id"}),Object(l.jsx)("dd",{children:e.id}),Object(l.jsx)("dt",{children:"readyState"}),Object(l.jsx)("dd",{children:e.readyState}),Object(l.jsx)("dt",{children:"enabled"}),Object(l.jsx)("dd",{children:String(e.enabled)}),Object(l.jsx)("dt",{children:"kind"}),Object(l.jsx)("dd",{children:e.kind}),Object(l.jsx)("dt",{children:"label"}),Object(l.jsx)("dd",{children:e.label}),Object(l.jsx)("dt",{children:"muted"}),Object(l.jsx)("dd",{children:String(e.muted)}),Object(l.jsx)("dt",{children:"capabilities"}),Object(l.jsx)("dd",{children:Object(l.jsx)(v,{content:n})}),Object(l.jsx)("dt",{children:"constraints"}),Object(l.jsx)("dd",{children:Object(l.jsx)(v,{content:t.getConstraints()})}),Object(l.jsx)("dt",{children:"settings"}),Object(l.jsx)("dd",{children:Object(l.jsx)(v,{content:t.getSettings()})})]})},O=n(4),m=n(14),x=["srcObject","muted"],p=function(e){var t=e.srcObject,n=void 0===t?null:t,i=e.muted,r=void 0!==i&&i,s=Object(m.a)(e,x),a=Object(c.useRef)(null);return Object(c.useEffect)((function(){var e=a.current;null!==e&&(e.srcObject!==n&&(e.srcObject=n),e.muted!==r&&(e.muted=r))}),[n,r]),Object(l.jsx)("video",Object(O.a)(Object(O.a)({},s),{},{ref:a}))},g=function(e){var t=e.stream,n=Object(c.useState)(!0),i=Object(a.a)(n,2),r=(i[0],i[1]),s=function(){r((function(e){return!e}))},o=function(){return null===t?[]:t.getTracks()},d=o().map((function(e){return Object(l.jsx)("li",{children:Object(l.jsx)(f,{enabled:e.enabled,id:e.id,kind:e.kind,label:e.label,muted:e.muted,readyState:e.readyState,track:e})},e.id)}));return Object(l.jsxs)("div",{style:{display:"flex"},children:[Object(l.jsx)("h1",{children:"Scenario View"}),Object(l.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(l.jsx)("button",{onClick:function(){o().forEach((function(e){return e.enabled=!1})),s()},children:"pause"}),Object(l.jsx)("button",{onClick:function(){o().forEach((function(e){return e.enabled=!0})),s()},children:"continue"}),Object(l.jsx)("button",{onClick:function(){o().forEach((function(e){return e.stop()})),s()},children:"stop"})]}),Object(l.jsx)(p,{id:"video-chat",srcObject:t,autoPlay:!0}),t&&Object(l.jsxs)("div",{children:[Object(l.jsx)("h2",{children:"stream"}),Object(l.jsxs)("ul",{children:[Object(l.jsxs)("li",{children:["id: ",t.id]}),Object(l.jsxs)("li",{children:["active: ",JSON.stringify(t.active)]})]}),Object(l.jsx)("h2",{children:"tracks"}),Object(l.jsx)("ul",{children:d})]})]})},y=function(e){return e instanceof Error?Promise.reject(e):Promise.resolve(e)},k={permissionState:"granted",scenarioSummary:h.a.requestedDeviceTypeNotAttached.summary},S=function(){var e=Object(c.useState)(),t=Object(a.a)(e,2),n=t[0],r=t[1],s=Object(c.useState)(""),o=Object(a.a)(s,2),f=o[0],O=o[1],m=Object(c.useState)(!1),x=Object(a.a)(m,2),p=x[0],S=x[1],C=Object(c.useState)(),D=Object(a.a)(C,2),w=D[0],I=D[1],E=Object(c.useState)(null),L=Object(a.a)(E,2),R=L[0],P=L[1],F=Object(c.useState)([]),U=Object(a.a)(F,2),N=U[0],_=U[1],J=Object(c.useState)(k.permissionState),B=Object(a.a)(J,2),T=B[0],M=B[1];Object(c.useEffect)((function(){try{var e="undefined"===f?void 0:JSON.parse(f);I(e),S(!1)}catch(t){S(!0)}}),[f,S]),Object(c.useEffect)((function(){var e;if(void 0!==n){var t=null===(e=h.a.all.get(n))||void 0===e?void 0:e.constraints,c=void 0===t?"undefined":JSON.stringify(t,null,2);O(c)}else{var i=Array.from(h.a.all.keys()),s=i.includes(k.scenarioSummary)?k.scenarioSummary:i[0];r(s)}}),[n]),Object(c.useEffect)((function(){_((function(){return[]}))}),[n]);var A=function(){_((function(){return[]}))},q=function(){var e=Object(u.a)(d.a.mark((function e(){var t,c,i,r,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(i=h.a.all.get(null!==n&&void 0!==n?n:""))&&null!==R){e.next=3;break}return e.abrupt("return");case 3:return r=null!==(t=null===(c=i.expected[T])||void 0===c?void 0:c.checks)&&void 0!==t?t:[],s=r.map(function(){var e=Object(u.a)(d.a.mark((function e(t){var n,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.predicate(y(R));case 3:n=e.sent,e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),c=["check threw exception ".concat(e.t0.toString())],n={success:!1,messages:c};case 10:return e.abrupt("return",{what:t.what,details:n});case 11:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()),e.t0=_,e.next=8,Promise.all(s);case 8:e.t1=e.sent,(0,e.t0)(e.t1);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(l.jsxs)("div",{children:[Object(l.jsxs)("h1",{children:["Test Rig",p?" (parse error)":""]},"test-rig"),Object(l.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[Object(l.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(l.jsxs)("select",{name:"device",children:[Object(l.jsx)("option",{children:"camera"}),Object(l.jsx)("option",{children:"microphone"})]}),Object(l.jsxs)("select",{name:"permission",onChange:function(e){var t=e.target.value;"granted"!==t&&"denied"!==t&&"prompt"!==t||M(t)},value:T,children:[Object(l.jsx)("option",{value:"granted",children:"granted"}),Object(l.jsx)("option",{value:"denied",children:"denied"}),Object(l.jsx)("option",{value:"prompt",children:"prompt"})]}),Object(l.jsx)("select",{name:"scenarios",value:n,onChange:function(e){return r(e.target.value)},children:Array.from(h.a.all.keys()).map((function(e){return Object(l.jsx)("option",{value:e,children:e},e)}))})]}),Object(l.jsx)("textarea",{value:f,onChange:function(e){return O(e.target.value)}}),Object(l.jsx)("button",{onClick:function(){navigator.mediaDevices.getUserMedia(w).then((function(e){return P((function(){return e}))})).catch((function(e){return P((function(){return e}))}))},children:"start"}),Object(l.jsx)("button",{disabled:null===R,onClick:q,children:"run checks"}),Object(l.jsx)("button",{disabled:0===N.length,onClick:A,children:"clear checks"}),Object(l.jsx)("button",{onClick:function(){R instanceof MediaStream&&R.getTracks().forEach((function(e){return e.stop()})),A(),P(null)},children:"detach"}),Object(l.jsx)("ul",{children:N.map((function(e,t){var n,c=e.details.success?"\u2705":"\u274c",r=null!==(n=e.details.messages)&&void 0!==n?n:[],s=!e.details.success&&0!==r.length?Object(l.jsx)("ul",{children:r.map((function(e,n){return Object(l.jsx)("li",{children:e},"message ".concat(t," ").concat(n))}))},"message ".concat(t)):null;return Object(l.jsxs)(i.a.Fragment,{children:[Object(l.jsx)("li",{children:"".concat(c,": ").concat(e.what)},"check result ".concat(t)),s]},"doombuggy ".concat(t))}))},"results")]}),null===R?null:R instanceof MediaStream?Object(l.jsx)(g,{stream:R}):Object(l.jsx)(b,{error:R}),Object(l.jsx)(j,{hide:!0,children:Object(l.jsx)(v,{content:navigator.mediaDevices.getSupportedConstraints()})})]})},C=i.a.createContext(void 0),D=function(){var e=Object(c.useContext)(C);if(void 0===e)throw new Error("Context not available in component tree parents");return e.recordingDirector},w=function(e){var t=D(),n=Object(c.useState)({stream:null,streamError:"none"}),i=Object(a.a)(n,2),r=i[0],s=i[1];return Object(c.useEffect)((function(){if(void 0!==e){var n=t.videoStreamSubscriptionFor(e);return n.onDeviceRemoved((function(){n.cancel(),s({stream:null,streamError:"DeviceRemoved"})})),n.stream.then((function(e){return s((function(){return{stream:e,streamError:"none"}}))})).catch((function(){return s((function(){return{stream:null,streamError:"CouldNotOpen"}}))})),function(){n.cancel(),s((function(){return{stream:null,streamError:"none"}}))}}}),[t,e]),r},I=function(){var e=Object(c.useState)(void 0),t=Object(a.a)(e,2),n=t[0],i=t[1],r=D();Object(c.useEffect)((function(){var e=function(e){i((function(){return e}))};return r.addOnCameraSelectionChanged(e),function(){r.removeOnCameraSelectionChanged(e)}}),[r]);var s=w(n),o=s.stream,d=s.streamError;if(void 0===n)return Object(l.jsx)("div",{children:"No device selected"});if("none"!==d)return Object(l.jsx)("div",{children:d});if(null===o)return Object(l.jsx)("div",{children:"Opening stream"});return Object(l.jsxs)("div",{children:[Object(l.jsx)(p,{srcObject:o,autoPlay:!0,onClick:function(){r.clearCameraSelection()}}),Object(l.jsx)("div",{children:o.id})]})},E=function(e){var t,n=e.recordingDirector,c=e.device,i=e.index,r=w(c),s=r.stream,a=r.streamError,o="none"===a;return Object(l.jsxs)("div",{children:[Object(l.jsxs)("h4",{children:["Camera ",i]}),Object(l.jsxs)("ul",{children:[Object(l.jsxs)("li",{children:["device label: ",c.label]}),Object(l.jsxs)("li",{children:["device id: ",c.deviceId]}),Object(l.jsxs)("li",{children:["group id: ",c.groupId]}),Object(l.jsxs)("li",{children:["stream id: ",null!==(t=null===s||void 0===s?void 0:s.id)&&void 0!==t?t:"no-stream"]})]}),!o&&Object(l.jsx)("div",{children:a}),o&&Object(l.jsx)(p,{onClick:function(){n.selectCamera(c)},width:150,srcObject:s,autoPlay:!0})]})},L=function(){var e=D(),t=Object(c.useState)({showPreviews:!1,forceReRender:0}),n=Object(a.a)(t,2),i=n[0].showPreviews,r=n[1];Object(c.useEffect)((function(){var t=function(){r((function(e){return Object(O.a)(Object(O.a)({},e),{},{forceReRender:e.forceReRender+1})}))};return e.addOnUpdateDevicesListener(t),function(){e.removeOnUpdateDevicesListener(t)}}),[e]);var s=i?Object(l.jsx)("button",{onClick:function(){return r((function(e){return Object(O.a)(Object(O.a)({},e),{},{showPreviews:!1})}))},children:"Hide Previews"}):Object(l.jsx)("button",{onClick:function(){return r((function(e){return Object(O.a)(Object(O.a)({},e),{},{showPreviews:!0})}))},children:"Show Previews"}),o=i?e.cameras().map((function(t,n){return Object(l.jsx)(E,{index:n,device:t,recordingDirector:e},t.deviceId)})):null;return Object(l.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[s,o]})},R=n(11),P=n(2),F=n(3),U=n(24),N=function(){},_=function(){function e(t,n){Object(P.a)(this,e),this.recordingDirector=t,this.subscriptionDetails=n,this._onDeviceRemoved=function(){},this._canceled=!1,this._deviceRemoved=!1}return Object(F.a)(e,[{key:"stream",get:function(){return this._canceled||this._deviceRemoved?Promise.reject("subscription canceled"):this.subscriptionDetails.stream}},{key:"onDeviceRemoved",value:function(e){this._onDeviceRemoved=e}},{key:"deviceRemoved",value:function(){this._deviceRemoved=!0,this._onDeviceRemoved()}},{key:"cancel",value:function(){this.recordingDirector.cancelSubscription(this.subscriptionDetails),this._canceled=!0}}]),e}(),J=function(){function e(){Object(P.a)(this,e),this.subscriptionsByDevice=new Map}return Object(F.a)(e,[{key:"addSubscriber",value:function(e){var t=e.subscriptionDetails;(function(e,t,n){var c=e.get(t);if(void 0!==c)return c;var i=n(t);return e.set(t,i),i})(this.subscriptionsByDevice,t.deviceIdentifier,(function(){return{stream:e.stream,subscriptions:new Map}})).subscriptions.set(t.subscriptionIdentifier,e)}},{key:"subscriptionsTo",value:function(e){return Array.from(this.subscriptionsByDevice.entries()).filter((function(t){var n=Object(a.a)(t,2),c=n[0];n[1];return e.includes(c)})).map((function(e){var t=Object(a.a)(e,2),n=(t[0],t[1]);return Array.from(n.subscriptions.values())})).reduce((function(e,t){return e.concat(t)}),[])}},{key:"removeSubscriber",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N,n=this.subscriptionsByDevice.get(e.deviceIdentifier);void 0!==n&&(n.subscriptions.delete(e.subscriptionIdentifier),0===n.subscriptions.size&&(this.subscriptionsByDevice.delete(e.deviceIdentifier),t(n.stream)))}},{key:"streamFor",value:function(e){var t=this.subscriptionsByDevice.get(e.deviceId);if(void 0!==t)return t.stream}}]),e}(),B=function(){function e(){Object(P.a)(this,e),this.onUpdateDevicesListeners=new Set,this.subscriptionLedger=new J,this.devices=[],this.onCameraSelectionChangedListeners=new Set,this.selectedCamera=void 0}return Object(F.a)(e,[{key:"updateDevices",value:function(e){var t,n=e.map((function(e){return e.deviceId})),c=this.devices.filter((function(e){return!n.includes(e.deviceId)})).map((function(e){return e.deviceId}));this.devices.splice(0,this.devices.length),(t=this.devices).push.apply(t,Object(R.a)(e)),this.onUpdateDevicesListeners.forEach((function(e){return e()})),this.subscriptionLedger.subscriptionsTo(c).forEach((function(e){return e.deviceRemoved()}))}},{key:"cameras",value:function(){return this.devices.filter((function(e){return"videoinput"===e.kind})).filter((function(e){return"default"!==e.label}))}},{key:"videoStreamSubscriptionFor",value:function(e){var t={deviceIdentifier:e.deviceId,stream:this.streamForDevice(e),subscriptionIdentifier:Object(U.a)()},n=new _(this,t);return this.subscriptionLedger.addSubscriber(n),n}},{key:"cancelSubscription",value:function(e){var t=this;this.subscriptionLedger.removeSubscriber(e,(function(e){return e.then(t.close).catch(N)}))}},{key:"streamForDevice",value:function(e){var t=this,n=this.subscriptionLedger.streamFor(e);return void 0!==n?n:this.videoStreamFor(e).then((function(n){return""===e.label&&navigator.mediaDevices.enumerateDevices().then((function(e){var n=e.map((function(e){return{kind:e.kind,label:e.label,deviceId:e.deviceId,groupId:e.groupId}}));console.log(n),t.updateDevices(n)})),n}))}},{key:"videoStreamFor",value:function(e){return navigator.mediaDevices.getUserMedia({video:{deviceId:e.deviceId}})}},{key:"selectCamera",value:function(e){var t=this;void 0!==this.selectedCamera&&this.selectedCamera.kind===e.kind&&this.selectedCamera.groupId===e.groupId&&this.selectedCamera.deviceId===e.deviceId?console.log("already selected"):(this.selectedCamera=e,this.onCameraSelectionChangedListeners.forEach((function(e){return e(t.selectedCamera)})))}},{key:"clearCameraSelection",value:function(){var e=this;void 0!==this.selectedCamera&&(this.selectedCamera=void 0,this.onCameraSelectionChangedListeners.forEach((function(t){return t(e.selectedCamera)})))}},{key:"addOnUpdateDevicesListener",value:function(e){this.onUpdateDevicesListeners.add(e)}},{key:"removeOnUpdateDevicesListener",value:function(e){this.onUpdateDevicesListeners.delete(e)}},{key:"addOnCameraSelectionChanged",value:function(e){this.onCameraSelectionChangedListeners.add(e),e(this.selectedCamera)}},{key:"removeOnCameraSelectionChanged",value:function(e){this.onCameraSelectionChangedListeners.delete(e)}},{key:"close",value:function(e){e&&e.getTracks().forEach((function(e){return e.stop()}))}}]),e}(),T=function(){navigator.mediaDevices.enumerateDevices().then((function(e){console.log("there are ".concat(e.length," devices"));var t=e.map((function(e){return"".concat(e.kind," ").concat(e.label," (").concat(e.groupId,":").concat(e.deviceId,")")})).join("\n");console.log(t)})).catch((function(e){return console.log(e)}))},M=function(){var e=Object(c.useState)(!0),t=Object(a.a)(e,2),n=t[0],i=t[1];return Object(l.jsx)(l.Fragment,{children:Object(l.jsxs)("div",{style:{display:"flex"},children:[Object(l.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(l.jsx)("button",{onClick:T,children:"log device information"}),Object(l.jsx)("button",{onClick:function(){return i((function(e){return!e}))},children:"toggle camera picker"}),n&&Object(l.jsx)(L,{})]}),Object(l.jsx)(I,{})]})})},A=function(){var e=new B,t=function(){return function(e){navigator.mediaDevices.enumerateDevices().then((function(t){e.updateDevices(t.map((function(e){return{groupId:e.groupId,deviceId:e.deviceId,label:e.label,kind:e.kind}})))})).catch((function(e){console.log(e.name+": "+e.message)}))}(e)};return t(),navigator.mediaDevices.addEventListener("devicechange",t),function(){return Object(l.jsxs)(C.Provider,{value:{recordingDirector:e},children:[Object(l.jsx)(M,{}),Object(l.jsx)(S,{})]})}}();s.a.render(Object(l.jsx)("div",{children:Object(l.jsx)(A,{})}),document.getElementById("root"))}},[[22,1,2]]]);
//# sourceMappingURL=main.413a5942.chunk.js.map