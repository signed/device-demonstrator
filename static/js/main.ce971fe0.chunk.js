(this["webpackJsonpdevice-demonstrator"]=this["webpackJsonpdevice-demonstrator"]||[]).push([[0],{10:function(e,t,n){e.exports=n(16)},15:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(6),c=n.n(a),s=(n(15),n(1)),o=n(2),l=n(4),u=n(3),d=n(9),m=function(e){var t=e.srcObject,n=void 0===t?null:t,a=e.muted,c=void 0!==a&&a,s=Object(d.a)(e,["srcObject","muted"]),o=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e=o.current;null!==e&&(e.srcObject!==n&&(e.srcObject=n),e.muted!==c&&(e.muted=c))}),[n,c]),i.a.createElement("video",Object.assign({},s,{ref:o}))},v=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).handleDeviceSelectionChange=function(e){r.closeExistingStream(),r.setState({device:e},(function(){if(void 0!==e){var t=r.props.recordingDirector.videoStreamSubscriptionFor(e);r.setState({mediaStreamSubscription:t}),t.stream.then((function(e){return r.setState({stream:e})})).catch((function(){return r.setState({streamError:!0})}))}}))},r.state={streamError:!1,stream:null,mediaStreamSubscription:void 0,device:void 0},r}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.props.recordingDirector.addOnCameraSelectionChanged(this.handleDeviceSelectionChange)}},{key:"componentWillUnmount",value:function(){this.props.recordingDirector.removeOnCameraSelectionChanged(this.handleDeviceSelectionChange),this.closeExistingStream(),this.setState({device:void 0,streamError:!1})}},{key:"render",value:function(){return void 0===this.state.device?i.a.createElement("div",null,"No device selected"):null===this.state.stream?i.a.createElement("div",null,"Opening stream"):i.a.createElement("div",null,i.a.createElement(m,{srcObject:this.state.stream,autoPlay:!0}),i.a.createElement("div",null,this.state.stream.id))}},{key:"closeExistingStream",value:function(){var e=this.state.mediaStreamSubscription;void 0!==e&&(e.cancel(),this.setState({stream:null,mediaStreamSubscription:void 0}))}}]),n}(i.a.Component),h=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).handleSelect=function(){r.props.recordingDirector.selectCamera(r.props.device)},r.state={mediaStreamSubscription:void 0,streamError:!1,stream:null},r}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.recordingDirector.videoStreamSubscriptionFor(this.props.device);this.setState({mediaStreamSubscription:t}),t.stream.then((function(t){return e.setState({stream:t})})).catch((function(){return e.setState({streamError:!0})}))}},{key:"componentWillUnmount",value:function(){var e=this.state.mediaStreamSubscription;void 0!==e&&(e.cancel(),this.setState({stream:null,mediaStreamSubscription:void 0}))}},{key:"render",value:function(){var e,t=this.state.stream,n=this.props.device;return i.a.createElement("div",null,i.a.createElement("h4",null,"Camera ",this.props.index),i.a.createElement("ul",null,i.a.createElement("li",null,"device label: ",n.label),i.a.createElement("li",null,"device id: ",n.deviceId),i.a.createElement("li",null,"group id: ",n.groupId),i.a.createElement("li",null,"stream id: ",null!==(e=null===t||void 0===t?void 0:t.id)&&void 0!==e?e:"no-stream")),i.a.createElement(m,{onClick:this.handleSelect,width:150,srcObject:t,autoPlay:!0}))}}]),n}(i.a.Component),p=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).handleShowPreview=function(){r.setState({showPreviews:!0})},r.handleHidePreview=function(){r.setState({showPreviews:!1})},r.state={showPreviews:!1},r}return Object(o.a)(n,[{key:"render",value:function(){var e=this,t=this.state.showPreviews?i.a.createElement("button",{onClick:this.handleHidePreview},"Hide Previews"):i.a.createElement("button",{onClick:this.handleShowPreview},"Show Previews"),n=this.state.showPreviews?this.props.recordingDirector.cameras().map((function(t,n){return i.a.createElement(h,{key:t.deviceId,index:n,device:t,recordingDirector:e.props.recordingDirector})})):null;return i.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},t,n)}}]),n}(i.a.Component),b=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return this.props.hide?null:i.a.createElement(i.a.Fragment,null,this.props.children)}}]),n}(i.a.Component),f=function(e){var t=e.content,n=JSON.stringify(t,null,2);return i.a.createElement("pre",null,n)},g=n(8),E=n(7),S=function(){},k=function(){function e(t,n){Object(s.a)(this,e),this.recordingDirector=t,this.subscriptionDetails=n,this.canceled=!1}return Object(o.a)(e,[{key:"cancel",value:function(){this.recordingDirector.cancelSubscription(this.subscriptionDetails),this.canceled=!0}},{key:"stream",get:function(){return this.canceled?Promise.reject("subscription canceled"):this.subscriptionDetails.stream}}]),e}(),y=function(){function e(){Object(s.a)(this,e),this.subscriptionsByDevice=new Map}return Object(o.a)(e,[{key:"addSubscriber",value:function(e){var t=e.device.deviceId,n=this.subscriptionsByDevice.get(t);void 0===n&&(n={stream:e.stream,subscribers:new Set},this.subscriptionsByDevice.set(t,n)),n.subscribers.add(e.subscriberIdentifier)}},{key:"removeSubscriber",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S,n=this.subscriptionsByDevice.get(e.device.deviceId);void 0!==n&&(n.subscribers.delete(e.subscriberIdentifier),0===n.subscribers.size&&(this.subscriptionsByDevice.delete(e.device.deviceId),t(n.stream)))}},{key:"streamFor",value:function(e){var t=this.subscriptionsByDevice.get(e.deviceId);if(void 0!==t)return t.stream}}]),e}(),C=function(){function e(){Object(s.a)(this,e),this.subscriptionLedger=new y,this.devices=[],this.onCameraSelectionChangedListeners=new Set,this.selectedCamera=void 0}return Object(o.a)(e,[{key:"updateDevices",value:function(e){var t;this.devices.splice(0,this.devices.length),(t=this.devices).push.apply(t,Object(g.a)(e))}},{key:"cameras",value:function(){return this.devices.filter((function(e){return"videoinput"===e.kind})).filter((function(e){return"default"!==e.label}))}},{key:"videoStreamSubscriptionFor",value:function(e){var t={device:e,stream:this.streamForDevice(e),subscriberIdentifier:Object(E.uuid)()};return this.subscriptionLedger.addSubscriber(t),new k(this,t)}},{key:"cancelSubscription",value:function(e){var t=this;this.subscriptionLedger.removeSubscriber(e,(function(e){return e.then(t.close).catch(S)}))}},{key:"streamForDevice",value:function(e){var t=this.subscriptionLedger.streamFor(e);return void 0!==t?t:this.videoStreamFor(e)}},{key:"videoStreamFor",value:function(e){return navigator.mediaDevices.getUserMedia({video:{deviceId:e.deviceId}})}},{key:"selectCamera",value:function(e){var t=this;void 0!==this.selectedCamera&&this.selectedCamera.kind===e.kind&&this.selectedCamera.groupId===e.groupId&&this.selectedCamera.deviceId===e.deviceId?console.log("already selected"):(this.selectedCamera=e,this.onCameraSelectionChangedListeners.forEach((function(e){return e(t.selectedCamera)})))}},{key:"addOnCameraSelectionChanged",value:function(e){this.onCameraSelectionChangedListeners.add(e),e(this.selectedCamera)}},{key:"removeOnCameraSelectionChanged",value:function(e){this.onCameraSelectionChangedListeners.delete(e)}},{key:"close",value:function(e){e&&e.getTracks().forEach((function(e){return e.stop()}))}}]),e}(),O=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e=this.props.track;return(i.a.createElement("dl",null,i.a.createElement("dt",null,"id"),i.a.createElement("dd",null,this.props.id),i.a.createElement("dt",null,"readyState"),i.a.createElement("dd",null,this.props.readyState),i.a.createElement("dt",null,"enabled"),i.a.createElement("dd",null,String(this.props.enabled)),i.a.createElement("dt",null,"kind"),i.a.createElement("dd",null,this.props.kind),i.a.createElement("dt",null,"label"),i.a.createElement("dd",null,this.props.label),i.a.createElement("dt",null,"muted"),i.a.createElement("dd",null,String(this.props.muted)),i.a.createElement("dt",null,"capabilities"),i.a.createElement("dd",null,i.a.createElement(f,{content:e.getCapabilities()})),i.a.createElement("dt",null,"constraints"),i.a.createElement("dd",null,i.a.createElement(f,{content:e.getConstraints()})),i.a.createElement("dt",null,"settings"),i.a.createElement("dd",null,i.a.createElement(f,{content:e.getSettings()}))))}}]),n}(i.a.Component),j=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).handleStart=function(){navigator.mediaDevices.getUserMedia({video:!0}).then((function(e){r.setState({source:e})})).catch((function(e){alert(e)}))},r.handlePause=function(){r.tracks().forEach((function(e){return e.enabled=!1})),r.triggerRender()},r.handleContinue=function(){r.tracks().forEach((function(e){return e.enabled=!0})),r.triggerRender()},r.handleStop=function(){r.tracks().forEach((function(e){return e.stop()})),r.triggerRender()},r.handleDetach=function(){r.setState({source:null})},r.state={source:null},r}return Object(o.a)(n,[{key:"tracks",value:function(){var e=this.state.source;return null===e?[]:e.getTracks()}},{key:"render",value:function(){var e=this.tracks().map((function(e){return i.a.createElement("li",{key:e.id},i.a.createElement(O,{enabled:e.enabled,id:e.id,kind:e.kind,label:e.label,muted:e.muted,readyState:e.readyState,track:e}))}));return i.a.createElement("div",{style:{display:"flex"}},i.a.createElement("h1",null,this.props.title),i.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},i.a.createElement("button",{onClick:this.handleStart},"start"),i.a.createElement("button",{onClick:this.handlePause},"pause"),i.a.createElement("button",{onClick:this.handleContinue},"continue"),i.a.createElement("button",{onClick:this.handleStop},"stop"),i.a.createElement("button",{onClick:this.handleDetach},"detach")),i.a.createElement(m,{id:"video-chat",srcObject:this.state.source,autoPlay:!0}),i.a.createElement("div",null,i.a.createElement("h2",null,"tracks"),i.a.createElement("ul",null,e)))}},{key:"triggerRender",value:function(){this.setState(this.state)}}]),n}(i.a.Component),D=function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{style:{display:"flex"}},i.a.createElement(p,{recordingDirector:e.recordingDirector}),i.a.createElement(v,{recordingDirector:e.recordingDirector})),i.a.createElement(b,{hide:!0},i.a.createElement(j,{title:"one"}),i.a.createElement(f,{content:navigator.mediaDevices.getSupportedConstraints()})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var w=function(){var e=new C,t=function(){return function(e){navigator.mediaDevices.enumerateDevices().then((function(t){e.updateDevices(t.map((function(e){return{groupId:e.groupId,deviceId:e.deviceId,label:e.label,kind:e.kind}})))})).catch((function(e){console.log(e.name+": "+e.message)}))}(e)};return t(),navigator.mediaDevices.addEventListener("devicechange",t),function(){return i.a.createElement(D,{recordingDirector:e})}}();c.a.render(i.a.createElement("div",null,i.a.createElement(w,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[10,1,2]]]);
//# sourceMappingURL=main.ce971fe0.chunk.js.map