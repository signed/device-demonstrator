(window["webpackJsonpdevice-demonstrator"]=window["webpackJsonpdevice-demonstrator"]||[]).push([[0],{12:function(e,t,n){e.exports=n(23)},17:function(e,t,n){},23:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(8),c=n.n(a),s=(n(17),n(1)),o=n(2),l=n(4),u=n(3),d=n(5),h=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.props.hide?null:r.a.createElement(r.a.Fragment,null,this.props.children)}}]),t}(r.a.Component),m=n(11),v=function(e){var t=e.srcObject,n=void 0===t?null:t,a=e.muted,c=void 0!==a&&a,s=Object(m.a)(e,["srcObject","muted"]),o=Object(i.useRef)(null);return Object(i.useEffect)(function(){var e=o.current;null!==e&&(e.srcObject!==n&&(e.srcObject=n),e.muted!==c&&(e.muted=c))},[n,c]),r.a.createElement("video",Object.assign({},s,{ref:o}))},b=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleDeviceSelectionChange=function(e){n.closeExistingStream(),n.setState({device:e},function(){if(void 0!==e){var t=n.props.recordingDirector.videoStreamSubscriptionFor(e);n.setState({mediaStreamSubscription:t}),t.stream.then(function(e){return n.setState({stream:e})}).catch(function(){return n.setState({streamError:!0})})}})},n.state={streamError:!1,stream:null,mediaStreamSubscription:void 0,device:void 0},n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.props.recordingDirector.addOnCameraSelectionChanged(this.handleDeviceSelectionChange)}},{key:"componentWillUnmount",value:function(){this.props.recordingDirector.removeOnCameraSelectionChanged(this.handleDeviceSelectionChange),this.closeExistingStream(),this.setState({device:void 0,streamError:!1})}},{key:"render",value:function(){return void 0===this.state.device?r.a.createElement("div",null,"No device selected"):null===this.state.stream?r.a.createElement("div",null,"Opening stream"):r.a.createElement("div",null,r.a.createElement(v,{srcObject:this.state.stream,autoPlay:!0}),r.a.createElement("div",null,this.state.stream.id))}},{key:"closeExistingStream",value:function(){var e=this.state.mediaStreamSubscription;void 0!==e&&(e.cancel(),this.setState({stream:null,mediaStreamSubscription:void 0}))}}]),t}(r.a.Component),p=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleSelect=function(){n.props.recordingDirector.selectCamera(n.props.device)},n.state={mediaStreamSubscription:void 0,streamError:!1,stream:null},n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.recordingDirector.videoStreamSubscriptionFor(this.props.device);this.setState({mediaStreamSubscription:t}),t.stream.then(function(t){return e.setState({stream:t})}).catch(function(){return e.setState({streamError:!0})})}},{key:"componentWillUnmount",value:function(){var e=this.state.mediaStreamSubscription;void 0!==e&&(e.cancel(),this.setState({stream:null,mediaStreamSubscription:void 0}))}},{key:"render",value:function(){var e=this.state.stream;return r.a.createElement("div",null,r.a.createElement("h4",null,this.props.device.label),null!==e&&r.a.createElement("div",null,e.id),void 0!==this.state&&r.a.createElement(v,{onClick:this.handleSelect,width:150,srcObject:e,autoPlay:!0}))}}]),t}(r.a.Component),f=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleShowPreview=function(){n.setState({showPreviews:!0})},n.handleHidePreview=function(){n.setState({showPreviews:!1})},n.state={showPreviews:!1},n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this,t=this.state.showPreviews?r.a.createElement("button",{onClick:this.handleHidePreview},"Hide Previews"):r.a.createElement("button",{onClick:this.handleShowPreview},"Show Previews"),n=this.state.showPreviews?this.props.recordingDirector.cameras().map(function(t){return r.a.createElement(p,{key:t.deviceId,device:t,recordingDirector:e.props.recordingDirector})}):null;return r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},t,n)}}]),t}(r.a.Component),S=n(10),g=n(9),E=n.n(g),k=function(){},y=function(){function e(t,n){Object(s.a)(this,e),this.recordingDirector=t,this.subscriptionDetails=n,this.canceled=!1}return Object(o.a)(e,[{key:"cancel",value:function(){this.recordingDirector.cancelSubscription(this.subscriptionDetails),this.canceled=!0}},{key:"stream",get:function(){return this.canceled?Promise.reject("subscription canceled"):this.subscriptionDetails.stream}}]),e}(),O=function(){function e(){Object(s.a)(this,e),this.subscriptionsByDevice=new Map}return Object(o.a)(e,[{key:"addSubscriber",value:function(e){var t=e.device.deviceId,n=this.subscriptionsByDevice.get(t);void 0===n&&(n={stream:e.stream,subscribers:new Set},this.subscriptionsByDevice.set(t,n)),n.subscribers.add(e.subscriberIdentifier)}},{key:"removeSubscriber",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k,n=this.subscriptionsByDevice.get(e.device.deviceId);void 0!==n&&(n.subscribers.delete(e.subscriberIdentifier),0===n.subscribers.size&&(this.subscriptionsByDevice.delete(e.device.deviceId),t(n.stream)))}},{key:"streamFor",value:function(e){var t=this.subscriptionsByDevice.get(e.deviceId);if(void 0!==t)return t.stream}}]),e}(),j=function(){function e(){Object(s.a)(this,e),this.subscriptionLedger=new O,this.devices=[],this.onCameraSelectionChangedListeners=new Set,this.selectedCamera=void 0}return Object(o.a)(e,[{key:"updateDevices",value:function(e){var t;this.devices.splice(0,this.devices.length),(t=this.devices).push.apply(t,Object(S.a)(e))}},{key:"cameras",value:function(){return this.devices.filter(function(e){return"videoinput"===e.kind}).filter(function(e){return"default"!==e.label})}},{key:"videoStreamSubscriptionFor",value:function(e){var t={device:e,stream:this.streamForDevice(e),subscriberIdentifier:E()()};return this.subscriptionLedger.addSubscriber(t),new y(this,t)}},{key:"cancelSubscription",value:function(e){var t=this;this.subscriptionLedger.removeSubscriber(e,function(e){return e.then(t.close).catch(k)})}},{key:"streamForDevice",value:function(e){var t=this.subscriptionLedger.streamFor(e);return void 0!==t?t:this.videoStreamFor(e)}},{key:"videoStreamFor",value:function(e){return navigator.mediaDevices.getUserMedia({video:{deviceId:e.deviceId}})}},{key:"selectCamera",value:function(e){var t=this;void 0!==this.selectedCamera&&this.selectedCamera.kind===e.kind&&this.selectedCamera.groupId===e.groupId&&this.selectedCamera.deviceId===e.deviceId?console.log("already selected"):(this.selectedCamera=e,this.onCameraSelectionChangedListeners.forEach(function(e){return e(t.selectedCamera)}))}},{key:"addOnCameraSelectionChanged",value:function(e){this.onCameraSelectionChangedListeners.add(e),e(this.selectedCamera)}},{key:"removeOnCameraSelectionChanged",value:function(e){this.onCameraSelectionChangedListeners.delete(e)}},{key:"close",value:function(e){e&&e.getTracks().forEach(function(e){return e.stop()})}}]),e}(),C=function(e){var t=e.content,n=JSON.stringify(t,null,2);return r.a.createElement("pre",null,n)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var D=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e=this.props.track;return r.a.createElement("dl",null,r.a.createElement("dt",null,"id"),r.a.createElement("dd",null,this.props.id),r.a.createElement("dt",null,"readyState"),r.a.createElement("dd",null,this.props.readyState),r.a.createElement("dt",null,"enabled"),r.a.createElement("dd",null,String(this.props.enabled)),r.a.createElement("dt",null,"kind"),r.a.createElement("dd",null,this.props.kind),r.a.createElement("dt",null,"label"),r.a.createElement("dd",null,this.props.label),r.a.createElement("dt",null,"muted"),r.a.createElement("dd",null,String(this.props.muted)),r.a.createElement("dt",null,"capabilities"),r.a.createElement("dd",null,r.a.createElement(C,{content:e.getCapabilities()})),r.a.createElement("dt",null,"constraints"),r.a.createElement("dd",null,r.a.createElement(C,{content:e.getConstraints()})),r.a.createElement("dt",null,"settings"),r.a.createElement("dd",null,r.a.createElement(C,{content:e.getSettings()})))}}]),t}(r.a.Component),w=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleStart=function(){navigator.mediaDevices.getUserMedia({video:!0}).then(function(e){n.setState({source:e})}).catch(function(e){alert(e)})},n.handlePause=function(){n.tracks().forEach(function(e){return e.enabled=!1}),n.triggerRender()},n.handleContinue=function(){n.tracks().forEach(function(e){return e.enabled=!0}),n.triggerRender()},n.handleStop=function(){n.tracks().forEach(function(e){return e.stop()}),n.triggerRender()},n.handleDetach=function(){n.setState({source:null})},n.state={source:null},n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"tracks",value:function(){var e=this.state.source;return null===e?[]:e.getTracks()}},{key:"render",value:function(){var e=this.tracks().map(function(e){return r.a.createElement("li",{key:e.id},r.a.createElement(D,{enabled:e.enabled,id:e.id,kind:e.kind,label:e.label,muted:e.muted,readyState:e.readyState,track:e}))});return r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("h1",null,this.props.title),r.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},r.a.createElement("button",{onClick:this.handleStart},"start"),r.a.createElement("button",{onClick:this.handlePause},"pause"),r.a.createElement("button",{onClick:this.handleContinue},"continue"),r.a.createElement("button",{onClick:this.handleStop},"stop"),r.a.createElement("button",{onClick:this.handleDetach},"detach")),r.a.createElement(v,{id:"video-chat",srcObject:this.state.source,autoPlay:!0}),r.a.createElement("div",null,r.a.createElement("h2",null,"tracks"),r.a.createElement("ul",null,e)))}},{key:"triggerRender",value:function(){this.setState(this.state)}}]),t}(r.a.Component),I=new j,P=function(){navigator.mediaDevices.enumerateDevices().then(function(e){I.updateDevices(e.map(function(e){return{groupId:e.groupId,deviceId:e.deviceId,label:e.label,kind:e.kind}}))}).catch(function(e){console.log(e.name+": "+e.message)})};P(),navigator.mediaDevices.addEventListener("devicechange",function(){return P()}),c.a.render(r.a.createElement("div",null,r.a.createElement("div",{style:{display:"flex"}},r.a.createElement(f,{recordingDirector:I}),r.a.createElement(b,{recordingDirector:I})),r.a.createElement(h,{hide:!0},r.a.createElement(w,{title:"one"}),r.a.createElement(C,{content:navigator.mediaDevices.getSupportedConstraints()}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[12,1,2]]]);
//# sourceMappingURL=main.fd7ed5a9.chunk.js.map